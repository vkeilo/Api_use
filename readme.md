# 项目说明文档

## 项目概述

该项目旨在**动态审查网页文本文件内容更新**，能够为新添加的内容进行威胁程度打分，以供后续安全分析

项目包含多功能工具集，分别用于实现**目录监测、目录备份、文本差异获取和威胁评估**等多个功能。项目通过结合这些不同的 Python 脚本和工具，提供一种用于监测文件目录中文件内容的变化、备份目录、比较文本差异并进行自然语言处理的综合解决方案。

## 项目文件

以下是项目中包含的主要文件和模块：

### 1. `agent_use.py`

- `agent_use.py` 包含了一个名为 `gpt_agent` 的 Python 类，用于与 用户定义的大模型（现支持chatglm2-6b/OpenAI GPT-3）进行交互。交互接口采用openai规范，该类提供了以下功能：

    - 初始化 GPT-3 模型
    - 角色回滚（删除对话记录）
    - 根据 JSON 对话内容进行角色扮演
    - 新增消息
    - 获取回答
    - 与用户进行实时交互（用以模型行为纠正）

### 2. `dir_back.py`

- `dir_back.py` 是一个用于备份目录的 Python 脚本。它允许用户创建目录的副本，以供后续内容对比或其他用途。功能包括：

    - 复制源文件夹到备份文件夹

### 3. `fwatch.py`

- `fwatch.py` 是一个用于监测目录中文件变化的 Python 脚本。它使用了 `fswatch` 工具来实时监测指定目录下的特定文件变化事件，并根据事件类型进行相应的处理。功能包括：

    - 免监测白名单制定（现含swp/swpx缓存文件类型）
    - 目录变化事件检测（现包括文件内容更新）
    - 待审查文件目录列表的更新

### 4. `get_diff.py`

- `get_diff.py` 是一个用于比较两个文本文件之间差异的 Python 脚本。借助 Python 标准库中的 `difflib` 模块来生成文本差异的比较结果。功能包括：

    - 比较两个文件差异信息，提取更改或新增的行的内容

### 5. `examiner.json`

- `examiner.json` 包含了对话记录的 JSON 文件，其中的对话内容为审查员角色的任务描述，用于提供给 api_use.py 进行角色的指定，在当前的指定下，该角色将提供的输入作为网页目录中新增加的内容，并对内容的威胁程度进行1-100的评分。

### 6. `dir_examiner.py`

- `dir_examiner.py` 是项目的核心脚本，整合调用了以上所有的功能脚本，并执行监测目录、备份目录、文本差异获取和自然语言处理等任务。它的核心功能包括：

    - 备份目录
    - 监测目录中文件的变化
    - 比较新内容与备份内容的差异
    - 使用用户指定的接口连接大模型，进行评估威胁程度
    - 与用户的实时交互（实现模型行为纠正）

## 使用方法

以下是项目中各模块的具体使用方法：

### 环境准备
- 开发使用系统为 `ubuntu22.04LTS` ，python版本为3.9.5,请根据`requirements.txt`中内容在安装好需要的库文件（推荐使用虚拟环境）
    ```sh
    pip install -r requirements.txt
    ```
- 确保系统中安装了fswatch工具:
    ```sh
    sudo apt-get install fswatch
    ```

### 目录监测和备份

- 使用 `dir_examiner.py` 脚本来监测目录中文件的变化，并可选择备份目录。在脚本中，可以设置目标目录和备份目录的路径。通过 `dir_scanner` 和 `backup_folder` 进行目录监测和备份。

### 文本差异获取

- 使用 `get_diff.py` 脚本来比较两个文本文件之间的差异。您可以调用以下函数：

    - `get_text_diff(file1, file2)`: 比较两个文本文件的差异，`file1` 和 `file2` 是要比较的文件的路径。函数将返回差异信息的列表。

    - `get_text_add(ori_file, modified_file)`: 提取添加的文本行，
